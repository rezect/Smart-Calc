# Умный калькулятор для терминала на Go

## 1. Общая информация

### 1.1. Наименование проекта
**SmartCalc** - калькулятор математических выражений для командной строки

### 1.2. Описание
CLI-приложение для вычисления математических выражений, поддерживающее базовые арифметические операции, скобки, унарные операторы и константы.

### 1.3. Целевая платформа
- Операционные системы: Linux, macOS, Windows
- Требования: установленный Go 1.20+

## 2. Функциональные требования

### 2.1. Базовый функционал (Обязательный)
#### 2.1.1. Ввод данных
- Чтение выражения из аргументов командной строки:
  ```bash
  ./smartcalc "(2 + 3) * 5"
  ```
- Чтение выражения из STDIN при отсутствии аргументов:
  ```bash
  echo "(2 + 3) * 5" | ./smartcalc
  ```

#### 2.1.2. Поддерживаемые операции
- Сложение: `+`
- Вычитание: `-`
- Умножение: `*`
- Деление: `/`
- Степень: `^`

#### 2.1.3. Приоритет операций (по убыванию)
1. Скобки: `()`
2. Унарный минус
3. Степень: `^`
4. Умножение, деление, остаток: `*`, `/`
5. Сложение, вычитание: `+`, `-`

#### 2.1.4. Вывод результата
- Число с плавающей точкой (float64)
- Сообщений об ошибках в STDERR

#### 2.1.5. Математические функции
- Квадратный корень: `sqrt(9)`
- Синус: `sin(pi)`
- Косинус: `cos(pi)`
- Тангенс: `tan(pi)`
- Натуральный логарифм: `log(10)`
- Экспонента: `exp(2)`

## 3. Технические требования

### 3.1. Архитектура проекта
```
smartcalc/
├── cmd/
│   └── smartcalc/
│       └── main.go          # Точка входа
├── internal/
│   ├── calculator/
│   │   ├── calculator.go    # Основная логика
│   │   ├── parser.go        # Парсинг выражений
│   │   ├── evaluator.go     # Вычисление
│   │   └── tokenizer.go     # Лексический анализ
│   └── cli/
│       └── cli.go           # Обработка CLI аргументов
├── go.mod
├── go.sum
└── README.md
```

### 3.2. Основные компоненты

#### 3.2.1. Токенизатор (`tokenizer.go`)
- Разбивает входную строку на токены
- Типы токенов:
  ```go
  type TokenType int

  const (
    Number TokenType = iota
    Operator
    Function
    Lparen
    Rparen
    Comma
    stringToken
    UnaryMinus
  )
  ```

#### 3.2.2. Парсер (`parser.go`)
- Преобразует инфиксную запись в обратную польскую (RPN)
- Использует алгоритм "Сортировочной станции" Дейкстры
- Обрабатывает приоритеты операций и унарные операторы

#### 3.2.3. Вычислитель (`evaluator.go`)
- Вычисляет выражение в RPN-форме
- Использует стек для промежуточных результатов
- Поддерживает переменные и функции

#### 3.2.4. CLI обработчик (`cli.go`)
- Обрабатывает флаги командной строки
- Управляет потоком ввода/вывода
- Отображает справку: `./smartcalc --help`

### 3.3. Обработка ошибок
- Неправильный синтаксис выражения
- Деление на ноль
- Неизвестный оператор или функция
- Несбалансированные скобки

## 4. Требования к коду

### 4.1. Стиль кодирования
- Следование официальному Code Style Guide Go
- Использование gofmt для форматирования
- Комментарии на английском языке для публичных методов
- Тесты для ключевых компонентов

### 4.2. Организация кода
- Разделение на пакеты по ответственности
- Неэкспортируемые структуры и методы в `internal/`
- Минимальная видимость

### 4.3. Используемые пакеты
- `fmt` - форматированный ввод/вывод
- `os` - работа с аргументами и STDIN
- `flag` - парсинг флагов командной строки
- `strconv` - преобразование строк в числа
- `strings` - работа со строками
- `unicode` - проверка символов
- `math` - математические функции
- `bufio` - буферизированный ввод
- `io` - интерфейсы ввода/вывода

## 5. Этапы реализации

### Этап 1: Базовый каркас (1-2 дня)
1. Создать структуру проекта
2. Реализовать точку входа (`main.go`)
3. Настроить обработку аргументов командной строки
4. Реализовать чтение из STDIN

### Этап 2: Лексический анализ (2-3 дня)
1. Создать токенизатор
2. Реализовать распознавание чисел
3. Реализовать распознавание операторов
4. Добавить обработку скобок

### Этап 3: Парсинг (3-4 дня)
1. Реализовать алгоритм сортировочной станции
2. Обработать приоритеты операций
3. Добавить поддержку унарных операторов
4. Реализовать преобразование в RPN

### Этап 4: Вычисление (2-3 дня)
1. Создать стековую машину
2. Реализовать вычисление RPN-выражений
3. Добавить обработку ошибок
4. Интегрировать все компоненты

### Этап 5: Расширения (3-4 дня)
1. Добавить поддержку переменных
2. Реализовать математические функции
3. Написать тесты
4. Создать документацию

## 6. Примеры использования

### Базовые операции:
```bash
$ ./smartcalc "2 + 2"
4

$ ./smartcalc "(2 + 3) * 4"
20

$ ./smartcalc "10 / 3"
3.3333333333333335
```

### С переменными:
```bash
$ ./smartcalc "x = 5, y = 3, x * y"
15
```

### С функциями:
```bash
$ ./smartcalc "sqrt(16)"
4

$ ./smartcalc "sin(pi / 2)"
0.9999999999999999
```

## 7. Критерии оценки

### Минимальные:
1. ✓ Компилируется без ошибок
2. ✓ Обрабатывает базовые арифметические операции
3. ✓ Поддерживает скобки и приоритеты
4. ✓ Читает выражение из аргументов и STDIN
5. ✓ Корректно обрабатывает ошибки

### Бонусные:
1. ✓ Поддерживает унарные операторы
2. ✓ Реализует математические функции
3. ✓ Использует алгоритм сортировочной станции
4. ✓ Имеет модульную архитектуру

### 8. Для тестирования:
```bash
# Тестовые выражения
"2 + 2"
"(3 + 5) * 2"
"10 / (2 + 3)"
"-5 + 10"
"sqrt(pi/2) + 2"
```
